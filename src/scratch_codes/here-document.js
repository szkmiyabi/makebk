bkm_body += `javascript:(function(){`;
bkm_body += `var diag_tbl = diag_tbl = document.querySelector('#cmtTable');`;
bkm_body += `var save_survey_btn = document.querySelector('button[name="update"]');`;
bkm_body += `var hash = {"0": "未判定","1": "はい","9": "はい(注記)","2": "いいえ","3": "なし"};`;
bkm_body += `var tab_sp = "<bkmk:tab>";`;
bkm_body += `var br_sp = "<bkmk:br>";`;
bkm_body += `var data_tab_sp = "<bkmk:data:tab>";`;
bkm_body += `var data_br_sp = "<bkmk:data:br>";`;
bkm_body += `var text_clean = function(str) {`;
bkm_body += `str=str.replace(/^ +/m,"");`;
bkm_body += `str=str.replace(/\t+/m,"");`;
bkm_body += `str=str.replace(/(\r\n|\r|\n)/g,""); `;
bkm_body += `return str;`;
bkm_body += `};`;
bkm_body += `var br_encode = function(str) {return str.replace(/(\r|\n|\r\n)/mg, br_sp);};`;
bkm_body += `var br_decode = function(str) {return str.replace(new RegExp(this.br_sp, "mg"), "\r\n");};`;
bkm_body += `var m_diag_result = function(cell) {return cell.querySelector('select[id^="result_"]');};`;
bkm_body += `var m_diag_comment =function(cell) {return cell.querySelector('textarea[id^="comment"]');};`;
bkm_body += `var m_diag_description = function(cell) {return cell.querySelector('textarea[id^="src_"]')};`;
bkm_body += `var m_diag_srccode = function(cell) {return cell.querySelector('textarea[id^="updsrc_"]')};`;
bkm_body += `var m_diag_exists_ta = function(tr) {`;
bkm_body += `if(tr.querySelectorAll('textarea').length > 0) return true;`;
bkm_body += `else return false;`;
bkm_body += `};`;
bkm_body += `var get_survey_key = function(key_val) {`;
bkm_body += `var ret_key = "";`;
bkm_body += `for(var key in hash) {`;
bkm_body += `var val = hash[key];`;
bkm_body += `if(key_val == val) {`;
bkm_body += `ret_key = key;`;
bkm_body += `break;`;
bkm_body += `}`;
bkm_body += `}`;
bkm_body += `return ret_key;`;
bkm_body += `};`;
bkm_body += `var m_diag_get_text = function(cell) {`;
bkm_body += `var txt = cell.innerHTML;`;
bkm_body += `var pt = new RegExp(/^([^<].+?)(<)/);`;
bkm_body += `if(pt.test(txt)) {`;
bkm_body += `return txt.match(pt)[1];`;
bkm_body += `} else {`;
bkm_body += `return txt;`;
bkm_body += `}`;
bkm_body += `};`;
bkm_body += `var m_diag_get_survey = function(cell) {`;
bkm_body += `var key = "";`;
bkm_body += `var obj = m_diag_result(cell);`;
bkm_body += `var opts = obj.getElementsByTagName("option");`;
bkm_body += `var idx = obj.selectedIndex;`;
bkm_body += `for(var j=0; j<opts.length; j++) {`;
bkm_body += `var opt = opts[j];`;
bkm_body += `if(j == idx) {`;
bkm_body += `key = opt.value;`;
bkm_body += `break;`;
bkm_body += `}`;
bkm_body += `}`;
bkm_body += `return this.hash[key];`;
bkm_body += `};`;
bkm_body += `var m_diag_get_comment = function(cell) {return m_diag_comment(cell).value;};`;
bkm_body += `var m_diag_get_description = function(cell) {return m_diag_description(cell).value;};`;
bkm_body += `var m_diag_get_srccode = function(cell) {return m_diag_srccode(cell).value;};`;
bkm_body += `var m_diag_set_survey = function(cell, flag) {`;
bkm_body += `var obj = m_diag_result(cell);`;
bkm_body += `var key = get_survey_key(flag);`;
bkm_body += `var opts = obj.getElementsByTagName("option");`;
bkm_body += `for(var j=0; j<opts.length; j++) {`;
bkm_body += `var opt = opts[j];`;
bkm_body += `if(opt.value == key) {`;
bkm_body += `obj.selectedIndex = j;`;
bkm_body += `break;`;
bkm_body += `}`;
bkm_body += `}`;
bkm_body += `};`;
bkm_body += `var m_diag_set_comment = function(cell, str) {m_diag_comment(cell).value = str;};`;
bkm_body += `var m_diag_set_description = function(cell, str) {m_diag_description(cell).value = str;}`;
bkm_body += `var m_diag_set_srccode = function(cell, str) {m_diag_srccode(cell).value = str;};`;